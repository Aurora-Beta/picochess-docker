var Chess=function(r,e){function n(){pr=new Array(128),cr={w:$,b:$},vr=x,gr={w:0,b:0},Er=$,hr=0,dr=1,_r=[],br={},sr={w:[{square:lr.a1,flag:or.QSIDE_CASTLE},{square:lr.h1,flag:or.KSIDE_CASTLE}],b:[{square:lr.a8,flag:or.QSIDE_CASTLE},{square:lr.h8,flag:or.KSIDE_CASTLE}]},u(a())}function t(){o(Z,J)}function o(r,e){var t=r.split(/\s+/),o=t[0],f=0;if(Sr=e,!i(r).valid)return!1;n(),t[2].indexOf("K")>-1&&(gr.w|=or.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(gr.w|=or.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(gr.b|=or.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(gr.b|=or.QSIDE_CASTLE);for(var l=0;l<o.length;l++){var p=o.charAt(l);if("/"===p)f+=8;else if(k(p))f+=parseInt(p,10);else{var c=p<"a"?x:U;s({type:p.toLowerCase(),color:c},D(f)),pr[f].type===G&&Sr===V&&(gr[c]&or.QSIDE_CASTLE&&cr[c]===$&&(sr[c][0]={square:f,flag:or.QSIDE_CASTLE}),gr[c]&or.KSIDE_CASTLE&&cr[c]!==$&&(sr[c][1]={square:f,flag:or.KSIDE_CASTLE})),f++}}return vr=t[1],Er="-"===t[3]?$:lr[t[3]],hr=parseInt(t[4],10),dr=parseInt(t[5],10),u(a()),!0}function i(r){var e={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},n=r.split(/\s+/);if(6!==n.length)return{valid:!1,error_number:1,error:e[1]};if(isNaN(n[5])||parseInt(n[5],10)<=0)return{valid:!1,error_number:2,error:e[2]};if(isNaN(n[4])||parseInt(n[4],10)<0)return{valid:!1,error_number:3,error:e[3]};if(!/^(-|[abcdefgh][36])$/.test(n[3]))return{valid:!1,error_number:4,error:e[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(n[2]))return{valid:!1,error_number:5,error:e[5]};if(!/^(w|b)$/.test(n[1]))return{valid:!1,error_number:6,error:e[6]};var t=n[0].split("/");if(8!==t.length)return{valid:!1,error_number:7,error:e[7]};for(var o=0;o<t.length;o++){for(var i=0,a=!1,f=0;f<t[o].length;f++)if(isNaN(t[o][f])){if(!/^[prnbqkPRNBQK]$/.test(t[o][f]))return{valid:!1,error_number:9,error:e[9]};i+=1,a=!1}else{if(a)return{valid:!1,error_number:8,error:e[8]};i+=parseInt(t[o][f],10),a=!0}if(8!==i)return{valid:!1,error_number:10,error:e[10]}}return"3"===n[3][1]&&"w"===n[1]||"6"===n[3][1]&&"b"===n[1]?{valid:!1,error_number:11,error:e[11]}:{valid:!0,error_number:0,error:e[0]}}function a(){for(var r=0,e="",n=lr.a8;n<=lr.h1;n++){if(pr[n]){r>0&&(e+=r,r=0);var t=pr[n].color,o=pr[n].type;e+=t===x?o.toUpperCase():o.toLowerCase()}else r++;n+1&136&&(r>0&&(e+=r),n!==lr.h1&&(e+="/"),r=0,n+=8)}var i="";gr[x]&or.KSIDE_CASTLE&&(i+="K"),gr[x]&or.QSIDE_CASTLE&&(i+="Q"),gr[U]&or.KSIDE_CASTLE&&(i+="k"),gr[U]&or.QSIDE_CASTLE&&(i+="q"),i=i||"-";var a=Er===$?"-":D(Er);return[e,vr,i,a,hr,dr].join(" ")}function f(r){for(var e=0;e<r.length;e+=2)"string"==typeof r[e]&&"string"==typeof r[e+1]&&(br[r[e]]=r[e+1]);return br}function u(r){_r.length>0||(r!==Z?(br.SetUp="1",br.FEN=r):(delete br.SetUp,delete br.FEN))}function l(r){var e=pr[lr[r]];return e?{type:e.type,color:e.color}:null}function s(r,e){if(!("type"in r&&"color"in r))return!1;if(-1===H.indexOf(r.type.toLowerCase()))return!1;if(!(e in lr))return!1;var n=lr[e];return(r.type!==W||cr[r.color]===$||cr[r.color]===n)&&(pr[n]={type:r.type,color:r.color},r.type===W&&(cr[r.color]=n),u(a()),!0)}function p(r){var e=l(r);return pr[lr[r]]=null,e&&e.type===W&&(cr[e.color]=$),u(a()),e}function c(r,e,n,t,o){var i={color:vr,from:e,to:n,flags:t,piece:r[e].type};return o&&(i.flags|=or.PROMOTION,i.promotion=o),r[n]?i.captured=r[n].type:t&or.EP_CAPTURE&&(i.captured=j),i}function v(r){function e(r,e,n,t,o){if(r[n].type!==j||q(t)!==ur&&q(t)!==ir)e.push(c(r,n,t,o));else for(var i=[F,G,M,B],a=0,f=i.length;a<f;a++)e.push(c(r,n,t,o,i[a]))}var n=[],t=vr,o=R(t),i={b:fr,w:ar},a=lr.a8,f=lr.h1,u=!1,l=!(void 0!==r&&"legal"in r)||r.legal;if(void 0!==r&&"square"in r){if(!(r.square in lr))return[];a=f=lr[r.square],u=!0}for(var s,p=a;p<=f;p++)if(136&p)p+=7;else{var v=pr[p];if(v&&v.color===t)if(v.type===j)for(s=p+X[t][0],pr[s]||(e(pr,n,p,s,or.NORMAL),s=p+X[t][1],i[t]!==q(p)||pr[s]||e(pr,n,p,s,or.BIG_PAWN)),g=2;g<4;g++)136&(s=p+X[t][g])||(pr[s]&&pr[s].color===o?e(pr,n,p,s,or.CAPTURE):s===Er&&e(pr,n,p,Er,or.EP_CAPTURE));else for(var g=0,E=Y[v.type].length;g<E;g++){var _=Y[v.type][g];for(s=p;;){if(136&(s+=_))break;if(pr[s]){if(pr[s].color===t)break;e(pr,n,p,s,or.CAPTURE);break}if(e(pr,n,p,s,or.NORMAL),"n"===v.type||"k"===v.type)break}}}if(!u||f===cr[t]){if(gr[t]&or.KSIDE_CASTLE)if(Sr===J){S=(b=cr[t])+2;null!==pr[b+1]||null!==pr[b+2]||h(o,cr[t])||h(o,b+1)||h(o,S)||e(pr,n,cr[t],S,or.KSIDE_CASTLE)}else{var b=cr[t],S="w"===t?lr.g1:lr.g8,A=!0;if((I=sr[t][1].square)===(L="w"===t?lr.f1:lr.f8));else for(p=I+(w=I-L>0?-1:1);p!==L;p+=w)if(pr[p]&&p!==cr[t]){A=!1;break}var C=!0,m=!1;if(b===S)m=h(o,S);else{for(p=b+(w=b-S>0?-1:1);p!==S;p+=w){if(pr[p]&&p!==sr[t][1].square){C=!1;break}if(h(o,p)){m=!0;break}}pr[S]&&S!==sr[t][1].square&&(C=!1)}A&&C&&!m&&e(pr,n,cr[t],S,or.KSIDE_CASTLE)}if(gr[t]&or.QSIDE_CASTLE)if(Sr===J){S=(b=cr[t])-2;null!==pr[b-1]||null!==pr[b-2]||null!==pr[b-3]||h(o,cr[t])||h(o,b-1)||h(o,S)||e(pr,n,cr[t],S,or.QSIDE_CASTLE)}else{var b=cr[t],S="w"===t?lr.c1:lr.c8,I=sr[t][0].square,L="w"===t?lr.d1:lr.d8,A=!0;if(I!==L)for(p=I+(w=I-L>0?-1:1);p!==L;p+=w)if(pr[p]&&p!==cr[t]){A=!1;break}var C=!0,m=!1;if(b===S)m=h(o,S);else{for(var w=b-S>0?-1:1,p=b+w;p!==S;p+=w){if(pr[p]&&p!==sr[t][0].square){C=!1;break}if(h(o,p)){m=!0;break}}pr[S]&&S!==sr[t][0].square&&(C=!1)}A&&C&&!m&&e(pr,n,cr[t],S,or.QSIDE_CASTLE)}}if(!l)return n;for(var P=[],p=0,E=n.length;p<E;p++)y(n[p]),d(t)||P.push(n[p]),T();return P}function g(r,e){var n="";if(r.flags&or.KSIDE_CASTLE)n="O-O";else if(r.flags&or.QSIDE_CASTLE)n="O-O-O";else{var t=I(r,e);r.piece!==j&&(n+=r.piece.toUpperCase()+t),r.flags&(or.CAPTURE|or.EP_CAPTURE)&&(r.piece===j&&(n+=D(r.from)[0]),n+="x"),n+=D(r.to),r.flags&or.PROMOTION&&(n+="="+r.promotion.toUpperCase())}return y(r),_()&&(b()?n+="#":n+="+"),T(),n}function E(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function h(r,e){for(var n=lr.a8;n<=lr.h1;n++)if(136&n)n+=7;else if(pr[n]&&pr[n].color===r){var t=pr[n],o=n-e,i=o+119;if(rr[i]&1<<nr[t.type]){if(t.type===j){if(o>0){if(t.color===x)return!0}else if(t.color===U)return!0;continue}if("n"===t.type||"k"===t.type)return!0;for(var a=er[i],f=n+a,u=!1;f!==e;){if(pr[f]){u=!0;break}f+=a}if(!u)return!0}}return!1}function d(r){return h(R(r),cr[r])}function _(){return d(vr)}function b(){return _()&&0===v().length}function S(){return!_()&&0===v().length}function A(){for(var r={},e=[],n=0,t=0,o=lr.a8;o<=lr.h1;o++)if(t=(t+1)%2,136&o)o+=7;else{var i=pr[o];i&&(r[i.type]=i.type in r?r[i.type]+1:1,i.type===M&&e.push(t),n++)}if(2===n)return!0;if(3===n&&(1===r[M]||1===r[B]))return!0;if(n===r[M]+2){for(var a=0,f=e.length,o=0;o<f;o++)a+=e[o];if(0===a||a===f)return!0}return!1}function C(){for(var r=[],e={},n=!1;;){var t=T();if(!t)break;r.push(t)}for(;;){var o=a().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(n=!0),!r.length)break;y(r.pop())}return n}function m(r){_r.push({move:r,kings:{b:cr.b,w:cr.w},turn:vr,castling:{b:gr.b,w:gr.w},ep_square:Er,half_moves:hr,move_number:dr})}function y(r){var e=vr,n=R(e);if(m(r),r.to!==r.from&&(pr[r.to]=pr[r.from],pr[r.from]=null),r.flags&or.EP_CAPTURE&&(vr===U?pr[r.to-16]=null:pr[r.to+16]=null),r.flags&or.PROMOTION&&(pr[r.to]={type:r.promotion,color:e}),pr[r.to].type===W){if(cr[pr[r.to].color]=r.to,r.flags&or.KSIDE_CASTLE){var t="w"===e?lr.f1:lr.f8,o=sr[e][1].square;pr[t]={type:G,color:e},t!==o&&pr[o].type===G&&(pr[o]=null)}else if(r.flags&or.QSIDE_CASTLE){var t="w"===e?lr.d1:lr.d8,o=sr[e][0].square;pr[t]={type:G,color:e},t!==o&&pr[o].type===G&&(pr[o]=null)}gr[e]=""}if(gr[e])for(var i=0,a=sr[e].length;i<a;i++)if(r.from===sr[e][i].square&&gr[e]&sr[e][i].flag){gr[e]^=sr[e][i].flag;break}if(gr[n])for(var i=0,a=sr[n].length;i<a;i++)if(r.to===sr[n][i].square&&gr[n]&sr[n][i].flag){gr[n]^=sr[n][i].flag;break}Er=r.flags&or.BIG_PAWN?"b"===vr?r.to-16:r.to+16:$,r.piece===j?hr=0:r.flags&(or.CAPTURE|or.EP_CAPTURE)?hr=0:hr++,vr===U&&dr++,vr=R(vr)}function T(){var r=_r.pop();if(!r)return null;var e=r.move;cr=r.kings,vr=r.turn,gr=r.castling,Er=r.ep_square,hr=r.half_moves,dr=r.move_number;var n=vr,t=R(vr);if(e.to!==e.from&&(pr[e.from]=pr[e.to],pr[e.from].type=e.piece,pr[e.to]=null),e.flags&or.CAPTURE)pr[e.to]={type:e.captured,color:t};else if(e.flags&or.EP_CAPTURE){var o;o=n===U?e.to-16:e.to+16,pr[o]={type:j,color:t}}if(e.flags&(or.KSIDE_CASTLE|or.QSIDE_CASTLE)){var i,a;e.flags&or.KSIDE_CASTLE?(i=sr[n][1].square,a="w"===n?lr.f1:lr.f8):e.flags&or.QSIDE_CASTLE&&(i=sr[n][0].square,a="w"===n?lr.d1:lr.d8),pr[i]={type:G,color:n},i!==a&&pr[a].type===G&&(pr[a]=null)}return e}function I(r,e){for(var n=v({legal:!e}),t=r.from,o=r.to,i=r.piece,a=0,f=0,u=0,l=0,s=n.length;l<s;l++){var p=n[l].from,c=n[l].to;i===n[l].piece&&t!==p&&o===c&&(a++,q(t)===q(p)&&f++,P(t)===P(p)&&u++)}return a>0?f>0&&u>0?D(t):u>0?D(t).charAt(1):D(t).charAt(0):""}function L(){for(var r="\n   +------------------------+\n",e=lr.a8;e<=lr.h1;e++){if(0===P(e)&&(r+=" "+"87654321"[q(e)]+" |"),pr[e]){var n=pr[e].type;r+=" "+(pr[e].color===x?n.toUpperCase():n.toLowerCase())+" "}else r+=" . ";e+1&136&&(r+="|\n",e+=8)}return r+="   +------------------------+\n",r+="     a  b  c  d  e  f  g  h\n"}function w(r,e){var n=E(r);if(e){var t=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(t)var o=t[1],i=t[2],a=t[3],f=t[4]}for(var u=v(),l=0,s=u.length;l<s;l++){if(n===E(g(u[l]))||e&&n===E(g(u[l],!0)))return u[l];if(t&&(!o||o.toLowerCase()===u[l].piece)&&lr[i]===u[l].from&&lr[a]===u[l].to&&(!f||f.toLowerCase()===u[l].promotion))return u[l]}return null}function q(r){return r>>4}function P(r){return 15&r}function D(r){var e=P(r),n=q(r);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function R(r){return r===x?U:x}function k(r){return-1!=="0123456789".indexOf(r)}function N(r){var e=O(r);e.san=g(e,!1),e.to=D(e.to),e.from=D(e.from);var n="";for(var t in or)or[t]&e.flags&&(n+=tr[t]);return e.flags=n,e}function O(r){var e=r instanceof Array?[]:{};for(var n in r)e[n]="object"==typeof n?O(r[n]):r[n];return e}function K(r){return r.replace(/^\s+|\s+$/g,"")}function Q(r){for(var e=v({legal:!1}),n=0,t=0,o=e.length;t<o;t++)y(e[t]),d(vr)||(r-1>0?n+=Q(r-1):n++),T();return n}var U="b",x="w",$=-1,j="p",B="n",M="b",G="r",F="q",W="k",H="pnbrqkPNBRQK",Z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",z=["1-0","0-1","1/2-1/2","*"],J=0,V=1,X={b:[16,32,17,15],w:[-16,-32,-17,-15]},Y={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},rr=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],er=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],nr={p:0,n:1,b:2,r:3,q:4,k:5},tr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},or={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ir=7,ar=6,fr=1,ur=0,lr={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},sr={w:[{square:lr.a1,flag:or.QSIDE_CASTLE},{square:lr.h1,flag:or.KSIDE_CASTLE}],b:[{square:lr.a8,flag:or.QSIDE_CASTLE},{square:lr.h8,flag:or.KSIDE_CASTLE}]},pr=new Array(128),cr={w:$,b:$},vr=x,gr={w:0,b:0},Er=$,hr=0,dr=1,_r=[],br={},Sr=J;return void 0===r&&(r=Z),void 0===e&&(e=J),o(r,e),{WHITE:x,BLACK:U,PAWN:j,KNIGHT:B,BISHOP:M,ROOK:G,QUEEN:F,KING:W,SQUARES:function(){for(var r=[],e=lr.a8;e<=lr.h1;e++)136&e?e+=7:r.push(D(e));return r}(),FLAGS:tr,load:function(r,e){return void 0===e&&(e=J),o(r,e)},reset:function(){return t()},moves:function(r){for(var e=v(r),n=[],t=0,o=e.length;t<o;t++)void 0!==r&&"verbose"in r&&r.verbose?n.push(N(e[t])):n.push(g(e[t],!1));return n},in_check:function(){return _()},in_checkmate:function(){return b()},in_stalemate:function(){return S()},in_draw:function(){return hr>=100||S()||A()||C()},insufficient_material:function(){return A()},in_threefold_repetition:function(){return C()},game_over:function(){return hr>=100||b()||S()||A()||C()},validate_fen:function(r){return i(r)},fen:function(){return a()},pgn:function(r){var e="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\n",n="object"==typeof r&&"number"==typeof r.max_width?r.max_width:0,t=[],o=!1;for(var i in br)t.push("["+i+' "'+br[i]+'"]'+e),o=!0;o&&_r.length&&t.push(e);for(var a=[];_r.length>0;)a.push(T());for(var f=[],u="";a.length>0;){var l=a.pop();_r.length||"b"!==l.color?"w"===l.color&&(u.length&&f.push(u),u=dr+"."):u=dr+". ...",u=u+" "+g(l,!1),y(l)}if(u.length&&f.push(u),void 0!==br.Result&&f.push(br.Result),0===n)return t.join("")+f.join(" ");for(var s=0,i=0;i<f.length;i++)s+f[i].length>n&&0!==i?(" "===t[t.length-1]&&t.pop(),t.push(e),s=0):0!==i&&(t.push(" "),s++),t.push(f[i]),s+=f[i].length;return t.join("")},load_pgn:function(r,e){function n(r){return r.replace(/\\/g,"\\")}var i=void 0!==e&&"sloppy"in e&&e.sloppy,a="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",u=new RegExp("^(\\[(.|"+n(a)+")*\\])("+n(a)+")*1.("+n(a)+"|.)*$","g"),l=r.replace(u,"$1");"["!==l[0]&&(l=""),t();var s=function(r,e){for(var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o={},i=r.split(new RegExp(n(t))),a="",f="",u=0;u<i.length;u++)a=i[u].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),f=i[u].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),K(a).length>0&&(o[a]=f);return o}(l,e);for(var p in s)f([p,s[p]]),"variant"===p.toLowerCase()&&"chess960"===s[p].toLowerCase()&&(Sr=V);if("1"===s.SetUp&&!("FEN"in s&&o(s.FEN,Sr)))return!1;var c=r.replace(l,"").replace(new RegExp(n(a),"g")," ");c=c.replace(/(\{[^}]+\})+?/g,"");for(var v=/(\([^\(\)]+\))+?/g;v.test(c);)c=c.replace(v,"");var g=K(c=(c=(c=c.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));g=g.join(",").replace(/,,+/g,",").split(",");for(var E="",h=0;h<g.length-1;h++){if(null===(E=w(g[h],i)))return!1;y(E)}if(E=g[g.length-1],z.indexOf(E)>-1)(function(r){for(var e in r)return!0;return!1})(br)&&void 0===br.Result&&f(["Result",E]);else{if(null===(E=w(E,i)))return!1;y(E)}return!0},header:function(){return f(arguments)},ascii:function(){return L()},turn:function(){return vr},move:function(r,e){var n=void 0!==e&&"sloppy"in e&&e.sloppy,t=null;if("string"==typeof r)t=w(r,n);else if("object"==typeof r)if(Sr!==J&&"flags"in r&&(r.flags===tr.KSIDE_CASTLE||r.flags===tr.QSIDE_CASTLE))t=w(r.san,n);else for(var o=v(),i=0,a=o.length;i<a;i++)if(!(r.from!==D(o[i].from)||r.to!==D(o[i].to)||"promotion"in o[i]&&r.promotion!==o[i].promotion)){t=o[i];break}if(!t)return null;var f=N(t);return y(t),f},undo:function(){var r=T();return r?N(r):null},clear:function(){return n()},put:function(r,e){return s(r,e)},get:function(r){return l(r)},remove:function(r){return p(r)},perft:function(r){return Q(r)},square_color:function(r){if(r in lr){var e=lr[r];return(q(e)+P(e))%2==0?"light":"dark"}return null},history:function(r){for(var e=[],n=[],t=(void 0!==r&&"verbose"in r&&r.verbose);_r.length>0;)e.push(T());for(;e.length>0;){var o=e.pop();t?n.push(N(o)):n.push(g(o)),y(o)}return n}}};"undefined"!=typeof exports&&(exports.Chess=Chess),"undefined"!=typeof define&&define(function(){return Chess});